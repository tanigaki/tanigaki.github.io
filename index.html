<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Custom Dimension Settings -->
  <script>
  var dataLayer = dataLayer || [];
  dataLayer.push({
    'loginStatus': '未ログイン', // ログインステータス
    'userID': '2019010802' // ユーザーID
  });
  </script>
  <!-- End Custom Dimension Settings -->

  <!-- Google Tag Manager -->
  <script>(function (w, d, s, l, i) {
    w[l] = w[l] || [];
    w[l].push({
      'gtm.start':
        new Date().getTime(), event: 'gtm.js'
    });
    var f = d.getElementsByTagName(s)[0],
      j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
    j.async = true;
    j.src =
      'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
    f.parentNode.insertBefore(j, f);
  })(window, document, 'script', 'dataLayer', 'GTM-P7JKFS5');</script>
  <!-- End Google Tag Manager -->

  <meta charset="UTF-8">
  <title>Title</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
  <script
  src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="
  crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
  <script src="https://apis.google.com/js/api.js"></script>
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript>
  <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P7JKFS5"
  height="0" width="0" style="display:none;visibility:hidden"></iframe>
</noscript>
<!-- End Google Tag Manager (noscript) -->

<header class="ui segment container">
  <button id="signInButton">Google Login</button>
  <button id="signOutButton">Logout</button>
  <p id="loginStatus"></p>
</header>
<div class="ui container">
  <div class="ui form">
    <h1>フォームその1</h1>
    <form class="gtm-tracking-form" data-label="フォームその1">
      <div class="fields">
        <div class="field">
          <label>姓</label>
          <input
          type="text"
          placeholder="姓"
          class="gtm-tracking-input gtm-autofocus"
          name="family-name"
          data-label="１姓"
          required>
        </div>
        <div class="field">
          <label>名</label>
          <input
          type="text"
          placeholder="名"
          class="gtm-tracking-input"
          name="first-name"
          data-label="１名"
          required>
        </div>
      </div>

      <div class="fields">
        <div class="field">
          <label>セイ</label>
          <input
          type="text"
          placeholder="セイ"
          class="gtm-tracking-input"
          name="family-name-kana"
          data-label="セイ">
        </div>
        <div class="field">
          <label>メイ</label>
          <input
          type="text"
          placeholder="メイ"
          class="gtm-tracking-input"
          name="first-name-kana"
          data-label="メイ">
        </div>
      </div>

      <div class="field">
        <label>Gender</label>
        <select
        class="gtm-tracking-input"
        name="gender"
        data-label="性別">
          <option value="1">Male</option>
          <option value="2">Female</option>
        </select>
      </div>

      <div class="fields">
        <div class="grouped fields">
          <label for="fruit">好きな果物:</label>
          <div class="field">
            <div class="ui radio checkbox">
              <input
              type="radio"
              name="fruit"
              checked=""
              tabindex="0"
              class="hidden gtm-tracking-input"
              data-label="好きな果物">
              <label>りんご</label>
            </div>
          </div>
          <div class="field">
            <div class="ui radio checkbox">
              <input
              type="radio"
              name="fruit"
              tabindex="0"
              class="hidden gtm-tracking-input"
              data-label="好きな果物">
              <label>みかん</label>
            </div>
          </div>
          <div class="field">
            <div class="ui radio checkbox">
              <input
              type="radio"
              name="fruit"
              tabindex="0"
              class="hidden gtm-tracking-input"
              data-label="好きな果物">
              <label>洋ナシ</label>
            </div>
          </div>
          <div class="field">
            <div class="ui radio checkbox">
              <input
              type="radio"
              name="fruit"
              tabindex="0"
              class="hidden gtm-tracking-input"
              data-label="好きな果物">
              <label>グレープフルーツ</label>
            </div>
          </div>
        </div>
      </div>

      <div class="fields">
        <div class="ui checkbox">
          <input
          type="checkbox"
          name="example"
          class="gtm-tracking-input"
          data-label="利用規約同意">
          <label>利用規約に同意します。</label>
        </div>
      </div>
    </form>

    <h1>フォームその2</h1>
    <form class="gtm-tracking-form" data-label="フォームその2">
      <div class="fields">
        <div class="field">
          <label>姓</label>
          <input
          type="text"
          placeholder="姓"
          class="gtm-tracking-input"
          name="family-name"
          data-label="１姓"
          required>
        </div>
        <div class="field">
          <label>名</label>
          <input
          type="text"
          placeholder="名"
          class="gtm-tracking-input"
          name="first-name"
          data-label="１名"
          required>
        </div>
      </div>
    </form>

  </div>
</div>
<script>
// init semantic ui
$('.ui.radio.checkbox').checkbox();
$('.ui.dropdown').dropdown();
$('.ui.checkbox').checkbox();

// google OAuth
updateSigninStatus = isSignedIn => {
  if (isSignedIn) {
    const email = getUserData()
    document.querySelector('#loginStatus').innerHTML = `ログイン済み。ログイン中のメールアドレスは${email}です`
  } else {
    document.querySelector('#loginStatus').innerHTML = `未ログイン`
  }
}

getUserData = () => {
  const profile = gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile()
  const currentUserData = {
    name: profile.getName(),
    email: profile.getEmail()
  }
  return currentUserData.email
}

gapi.load('client:auth2', () => {
  gapi.client.init({
    client_id: "617085169896-g45r6jja7ov7phh4jr28edg1c2bfijom.apps.googleusercontent.com",
    scope: "email"
  }).then(() => {
    const auth = window.gapi.auth2.getAuthInstance()
    auth.isSignedIn.listen(updateSigninStatus)
    updateSigninStatus(auth.isSignedIn.get());
  });
});

document.querySelector('#signInButton').addEventListener('click', () => {
  window.gapi.auth2.getAuthInstance().signIn();
});

document.querySelector('#signOutButton').addEventListener('click', () => {
  window.gapi.auth2.getAuthInstance().signOut()
})

// gtm event tracking
// const inputs = [...document.querySelectorAll('.gtm-tracking-input')]
//
// function closest(node, selector) {
//   return (node.closest || function (_selector) {
//     do {
//       if ((node.matches || node.msMatchesSelector).call(node, _selector)) {
//         return node;
//       }
//       node = node.parentElement || node.parentNode;
//     } while (node !== null && node.nodeType === 1);
//
//     return null;
//   }).call(node, selector);
// }
//
// inputs.map(input => {
//   input.onfocus = () => {
//     const formName = closest(input, '.gtm-tracking-form').dataset.label
//     const data = {
//       'event': 'onfocus-form',
//       'inputLabel': input.dataset.label,
//       'formName': formName
//     }
//     console.log(data)
//   }
// })
//
// document.querySelector('.gtm-autofocus').focus()

</script>
</body>
</html>
